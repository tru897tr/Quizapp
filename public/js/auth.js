document.querySelectorAll('.tab').forEach(tab=>{tab.addEventListener('click',()=>{const targetTab=tab.dataset.tab;document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.auth-form').forEach(f=>f.classList.remove('active'));tab.classList.add('active');document.getElementById(targetTab+'Form').classList.add('active');hideMessage()})});document.getElementById('loginForm').addEventListener('submit',async(e)=>{e.preventDefault();hideMessage();const formData=new FormData(e.target);const data=Object.fromEntries(formData);try{const response=await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});const result=await response.json();if(result.success){showMessage('Đăng nhập thành công!','success');setTimeout(()=>window.location.href='/',1000)}else{showMessage(result.error,'error')}}catch(error){showMessage('Lỗi kết nối','error')}});document.getElementById('registerForm').addEventListener('submit',async(e)=>{e.preventDefault();hideMessage();const formData=new FormData(e.target);const data=Object.fromEntries(formData);try{const response=await fetch('/api/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});const result=await response.json();if(result.success){showMessage(result.message,'success');e.target.reset();setTimeout(()=>{document.querySelector('.tab[data-tab="login"]').click()},2000)}else{showMessage(result.error,'error')}}catch(error){showMessage('Lỗi kết nối','error')}});function showMessage(text,type){const msg=document.getElementById('message');msg.textContent=text;msg.className='message '+type+' show'}function hideMessage(){document.getElementById('message').className='message'}function showForgotPassword(){document.getElementById('forgotPasswordModal').style.display='flex'}function hideForgotPassword(){document.getElementById('forgotPasswordModal').style.display='none';document.getElementById('forgotEmail').value=''}async function submitForgotPassword(){const email=document.getElementById('forgotEmail').value;if(!email){alert('Vui lòng nhập email');return}try{const response=await fetch('/api/forgot-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email})});const result=await response.json();if(result.success){alert(result.message);hideForgotPassword()}else{alert(result.error)}}catch(error){alert('Lỗi kết nối')}}window.addEventListener('DOMContentLoaded',async()=>{try{const response=await fetch('/api/verify');if(response.ok){window.location.href='/'}}catch(error){}});
